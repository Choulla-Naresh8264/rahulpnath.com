<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>Rahul Nath</title>
  <meta name="author" content="Rahul Nath">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yoursite.com/posts/3">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Rahul Nath" type="application/atom+xml">

  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>

<link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">


  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  

</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Rahul Nath</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a rel="index" href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
                <li >
                    <a href="/blog/about">About</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:yoursite.com">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <div class="blog-index" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="Rahul Nath" />
    <meta itemprop="description" content="" />
    <meta itemprop="url" content="http://yoursite.com" />
      
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-04-17T16:34:01+05:30"  data-updated="true" itemprop="datePublished dateCreated">Apr 17<sup>th</sup>, 2013</time>
        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/windows-phone-series-mvvm-and-applicationbar/" itemprop="url">Windows Phone Series – MVVM and ApplicationBar</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>ApplicationBar on a windows phone, is to provide users of your app with quick access to the most commonly used tasks. For a mail app this would be refresh/new mail, for a photo app it might be like/unlike button, settings etc are common buttons that appear in an ApplicationBar . But then not always do we have them as static, and we would want to add/remove icons/menu items to that based on the applications current state.For example, you would want to add the like/unlike button only if the user is logged in, or even the settings icon would be only for logged in users. Whatever might be your scenario, if you are looking for to add/remove icons from the application bar from your code then this article is for you.</p>

<p>In a normal app which uses code-behind, this can be easily done by accessing the ‘ApplicationBar’ in the code-behind class like below</p>

<pre><code> ApplicationBar.Buttons.Add(&lt;your button&gt;);
</code></pre>

<p>When you are using MVVM you would want to do this from your ViewModel(VM). Below are the approaches that you could use to achieve the same</p>

<p><strong>1. Mesenger Service</strong></p>

<p>Whenever we need to communicate between VM’s or between your view model and View then we would want to do that in the most decoupled manner. When using <a href="http://www.galasoft.ch/mvvm/">MVVMLight</a>, we could use the Messenger class to achieve this. We would send a message indicating that we want to add a new appbar button from the ViewModel, and the View code behind, which already has registered for such an event would get notified and add the icon for us .</p>

<p>Below is how the Code-behind would look like . We register for a NotificationMessage(you could also use your own notification class for this), and see what kind of button needs to be added and adds that to the ApplicationBar. On click of the appbar button, we wire up the click event to a command of the ViewModel. Though there is some code behind in here, we are not going away from MVVM here, as we still have clear separation of concerns and also testability is not affected.</p>

<pre><code>public partial class MainPage : PhoneApplicationPage
{
    public MainViewModel viewModel
    {
        get
        {
            return this.DataContext as MainViewModel;
        }
    }

    private ApplicationBarIconButton settingsButton;
    // Constructor
    public MainPage()
    {
        InitializeComponent();
        settingsButton = new ApplicationBarIconButton()
        {
            Text = "Settings",
            IconUri = new Uri("Images/appbar.feature.settings.rest.png", UriKind.Relative)
        };
        settingsButton.Click += settingsButton_Click;
        // Register for the messenger 
        Messenger.Default.Register&lt;NotificationMessage&gt;(this, OnNotificationMessage);
    }

    void settingsButton_Click(object sender, EventArgs e)
    {
        viewModel.SettingsCommand.Execute(null);
    }

    private void OnNotificationMessage(NotificationMessage message)
    {
        // Check here for the notification
        // You can also build cutoms notification message here for this by inheriting from MessageBase
        if (message.Notification == "AddSettings")
        {
            if (ApplicationBar == null)
            {
                ApplicationBar = new ApplicationBar();
            }
            ApplicationBar.Buttons.Add(settingsButton);
        }
    }
}
</code></pre>

<hr />

<p><strong>2. ApplicationBar Service</strong></p>

<p>Like we use <a href="http://www.geekchamp.com/articles/mvvm-in-real-life-windows-phone-applications-part2">NavigationService</a>, for navigating from VM’s we could also create a ApplicationBarService, that can be used to add application bar icons from ViewModels. For this I have created a base class, MyModelBase, for all my VM’s which inturn inherits from ViewModelBase of MVVMLight. This base class holds an interface for the ApplicationBarService.</p>

<pre><code>public class MyModelBase: ViewModelBase
{
    public IApplicationBarService ApplicationBar { get; set; }

    public MyModelBase()
    {

    }
    public MyModelBase(IApplicationBarService appBar)
    {
        ApplicationBar = appBar;
    }
}
</code></pre>

<p>The interface IApplicationBarService, would have the functions that we would want to Add/Remove icons from the application bar. For now I have just put in the AddButton. You could also add RemoveButton and any other things that you would want in there.</p>

<pre><code>public interface IApplicationBarService
{
    IApplicationBar ApplicationBar { get;} 

    void AddButton(string title, Uri imageUrl, Action OnClick);
}
</code></pre>

<p>Implementation for this interface is as below</p>

<pre><code>public class ApplicationBarService: IApplicationBarService
{
    public void AddButton(string title, Uri imageUrl, Action OnClick)
    {
        ApplicationBarIconButton newButton = new ApplicationBarIconButton()
            {
                Text = title, 
                IconUri = imageUrl, 
            };
        newButton.Click += ((sender,e) =&gt; {OnClick.Invoke();}) ;

        ApplicationBar.Buttons.Add(newButton);

    }

    public IApplicationBar ApplicationBar
    {
        get
        {
            var currentPage = ((App)Application.Current).RootFrame.Content as PhoneApplicationPage;
            if (currentPage.ApplicationBar == null)
            {
                currentPage.ApplicationBar = new ApplicationBar();
            }
            return currentPage.ApplicationBar;
        }
    }
}
</code></pre>

<p>The ApplicationBar property reads gets the current ApplicationBar from the current page. If it is not defined then it would simply create a new one. The Add function just adds a new button and wires up the click event of the button, to the function that is passed in by the VM. We could also use Commands here, for now I just wanted to keep it simple</p>

<p>In cases where you don’t want to add buttons dynamically, but just have static buttons you could also use BindableApplicationBar implementations that are there. One such implementation is there along with the <a href="http://phone7.codeplex.com/">Phone7.Fx</a> library. There are also many other implementations for the same.</p>

<p>Hope this helps you to decouple your application bar icons from the ViewModel.You can find a <a href="https://github.com/rahulpnath/Blog/tree/master/PhoneAppBarMvvm">sample</a> implementation for this. In the sample both these approaches are shown for adding icons. You could figure out the Remove pretty easily.</p>

<p><a href="http://rahulpnath.com/blog/wp-content/uploads/2013/04/image4.png"><img src="http://rahulpnath.com/blog/wp-content/uploads/2013/04/image_thumb4.png" alt="image" /></a></p>

<p>Hope it helps!!</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-04-12T13:10:46+05:30"  data-updated="true" itemprop="datePublished dateCreated">Apr 12<sup>th</sup>, 2013</time>
        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/windows-phone-series-preloading-content/" itemprop="url">Windows Phone Series – Preloading Content</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>Mostly phone apps, connect to a service for the data and wrap them up to a cool UI for user consumption. But at times we would have apps that comes with a lot of preloaded content, with offline capability using <a href="http://visualstudiogallery.msdn.microsoft.com/cd120b42-30f4-446e-8287-45387a4f40b7">sqlite</a>.  Offline scenarios might either start of with preloaded content or get content on the apps first launch. This article is more for the scenario where we have preloaded content bundled with the app, and then on launch of the app, it would also get new content and updates to existing content. Complete knowledge of the pre-loaded content at the time of development would be rare. All you would know would be the metadata schema and how/where to look for the preloaded content.</p>

<p>We would not be creating a fully functional sample here, but would be touching on important aspects and the approaches that can be used to tackle similar scenarios and some code snippets</p>

<p>This <a href="http://blogs.windows.com/windows_phone/b/wpdev/archive/2013/03/12/using-the-sqlite-database-engine-with-windows-phone-8-apps.aspx">article</a> here would help you out on setting up sqlite for windows phone apps. Mostly we would be storing metadata of files/media that gets preloaded in the sqlite and keep the original files/media(preloaded content) packaged along with the xap, ideally by setting the <a href="http://msdn.microsoft.com/en-in/library/windowsphone/develop/ff967560(v=vs.105">Build Action to Content</a>.aspx#BKMK_Media).  Now in cases where we are expecting to update the existing content and also get new content we would have to copy out the entire media/files into the IsolatedStorage, so that we can do any further updates or additions.</p>

<p>Assuming that we have a folder “MyPreloadedContent” as indicated in the image below, which would be where all our preloaded content is going to be . Most of the time with preloaded content, we would not know what exact data would be in there. It might contain files, images, folders etc. We would want an easy way to set Build Action to Content for all the files/folders that gets placed under the folder( even if it is done outside of Visual Studio).</p>

<p><a href="http://rahulpnath.com/blog/wp-content/uploads/2013/04/image.png"><img src="http://rahulpnath.com/blog/wp-content/uploads/2013/04/image_thumb.png" alt="image" /></a></p>

<p>For this we would need to tweek the project file, to tell it that whatever is under MyPreloadedContent should be treated as ‘Content’. Edit the csproj file from notepad or any other text editor that you use(<a href="http://notepad-plus-plus.org/">Notepad++</a> is my personal favorite). Scroll down to wherever the other Content files are specified, like “<Content Include="ApplicationIcon.png">” for example. Add in the below line to make all the content put into that folder to be treated as Content, and save the csproj file.</p>

<pre><code>&lt;strong&gt;&lt;span style="font-size:large;"&gt;&lt;Content Include="MyPreloadedContent**" /&gt;&lt;/span&gt;&lt;/strong&gt;
</code></pre>

<p>Now you could open that folder and put in some content into that. For now I put in some image files and also a sub folder  as below</p>

<p><a href="http://rahulpnath.com/blog/wp-content/uploads/2013/04/image1.png"><img src="http://rahulpnath.com/blog/wp-content/uploads/2013/04/image_thumb1.png" alt="image" /></a></p>

<p>You would need to reload the projects/solution in visual studio to see that those files are automatically included into the solution. If not in a Visual studio,  msbuild would automatically include all the files as Content.</p>

<p><a href="http://rahulpnath.com/blog/wp-content/uploads/2013/04/image2.png"><img src="http://rahulpnath.com/blog/wp-content/uploads/2013/04/image_thumb2.png" alt="image" /></a></p>

<p>Now that we have all the files copied into that folder to be automatically included into the solution you need to now need to copy out all these files onto the IsolatedStorage when the app starts for the first time. You would want to do this, so that if there are any updates onto the files that you copied(which would be delivered to you via a web service in a real scenario), you can overwrite the files in the IsolatedStorage so that the new content would be taken then on.</p>

<p>Now comes the next challenge of getting all the files that are under MyPreloadedContent folder, so that you can copy them over to IsolatedStorage. Since this files would be copied at a later point of time, say at the time of packaging, we would not be able to know all the file names and directory structure prior.</p>

<p>We can use <a href="http://msdn.microsoft.com/en-us/library/vstudio/bb126445.aspx">T4 ( Text Templating Transformation Toolkit) templates</a> to help us out here. Using T4 templates we can generate a class file that will have a property returning us all the file names in the MyPreloadedContent directory.</p>

<p>To create a T4 template, add a new item to the project <strong>MyFiles.tt. </strong>Select Ok if you get any warning message</p>

<p><a href="http://rahulpnath.com/blog/wp-content/uploads/2013/04/image3.png"><img src="http://rahulpnath.com/blog/wp-content/uploads/2013/04/image_thumb3.png" alt="image" /></a></p>

<p>In a T4 template it would be a mix of text and code, that would be used to generate a new file that would be a class in our case which would expose a function to get all the file names under the folder . Below is the entire text/code that would go into the new file that we just created(<strong>MyFiles.tt</strong>)</p>

<pre><code>&lt;#@ template debug="false" hostspecific="true" language="C#" #&gt;
&lt;#@ output extension=".gen.cs" #&gt;
&lt;#@ import namespace="System.IO"#&gt;
// &lt;auto-generated /&gt;

namespace PreloadedContent
{
    public class MyFiles
    {
        private static string[] MyPreloadedContentFiles()
        {
            return new[] {
&lt;#
            DirectoryInfo directoryInfo = new DirectoryInfo(
               Path.Combine(Path.GetDirectoryName(Host.TemplateFile),"MyPreloadedContent"));
        foreach(FileInfo file in directoryInfo.GetFiles("*.*", SearchOption.AllDirectories))
            {
                if (!file.FullName.Contains(@"."))
                {#&gt;
                      "&lt;#= file.FullName.Substring(
                      file.FullName.IndexOf("MyPreloadedContent")).Replace(@"", "/") #&gt;",
&lt;#              }
            }
#&gt;
                        };
        }
    }
}
</code></pre>

<p>It just says to read the directory MyPreloadedContent and iterate to get all the files in that and writes it out by trimming of the absolute path and putting in only the relative path. Save the MyFiles.tt, and in Visual Studio right click on it and say “Run Custom Tool”. This would generate the cs file with an extension “.gen.cs” as we have mentioned in “<strong>&lt;#@ output extension=&ldquo;.gen.cs&rdquo; #>”.  </strong>The generated class would look like below</p>

<pre><code>namespace PreloadedContent
{
    public class MyFiles
    {
        private static string[] MyPreloadedContentFiles()
        {
            return new[] {
                           "MyPreloadedContent/picfinity login.png",
                           "MyPreloadedContent/Search.png",
                           "MyPreloadedContent/Share.png",
                           "MyPreloadedContent/upload.png",
                           "MyPreloadedContent/Profile/profile info.png",
                           "MyPreloadedContent/Profile/Profile.png",
                        };
        }
    }
}
</code></pre>

<p>The above class has all the file paths to the content and you could iterate that to copy out the files into the IsolatedStorage.</p>

<p>There are a couple of ways, by which you can ensure that the template file is run before the actual code gets compiled. This is to make sure that this generated class is going to be updated with the latest files that would be copied into the folder at build time i.e your templates are transformed at build time. This <a href="http://msdn.microsoft.com/en-us/library/ee847423.aspx">article</a> details out the methods to get that integrated into the build. On a build server where you dont have Visual Studio installed you would need to copy out these files mentioned <a href="http://msdn.microsoft.com/en-us/library/ee847423.aspx#buildserver">here</a> explicitly</p>

<p>With that integrated you are all set to go to build your app with preloaded content. You would not need to know anything about the file names/ structure of the content and it would just work as long as the metadata that drives it correct.</p>

<p>Hope it helps!!</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-04-08T10:42:07+05:30"  data-updated="true" itemprop="datePublished dateCreated">Apr 8<sup>th</sup>, 2013</time>
        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/mvvm-does-it-really-matter/" itemprop="url">MVVM – Does It Really Matter?</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>MVVM (Model-View-ViewModel), is a popular architectural pattern since WPF/Silverlight. Separation of concerns(UI/code), testability etc are some of the key things that motivates one to go via the MVVM route. There are innumerous articles out there, just like this <a href="http://msdn.microsoft.com/en-in/library/hh848246.aspx">one</a>, that gets into the details of how and why one should use MVVM.</p>

<p>With Windows phone also embracing xaml and silverlight, any one who knew silverlight turned a phone developer overnight. MVVM did find its way into this space too. But most of the phone app developers, unlike those who developed for enterprise. would have never cared for MVVM , as they rarely would have written test cases for their apps, nor were they actually concerned on the UI/code separation. Since most of the apps were just out of a hobby, the only idea was just to have it up and available in the store as fast as possible. I might not be fully correct here, but I do know at least a dozen people,including me, who did this, so am good enough to put out that statement</p>

<p>With windows 8 too taking the store way and having the same development platform of silverlight/xaml, don’t be surprised MVVM  showed up there too. Now anyone who had an app on the phone, had to do a lot of copy pasting over the code to have the same application available in both the stores. This gives MVVM a totally new dimension for motivation that was not spoken  about earlier – <strong><em>Reusability. </em></strong></p>

<p>Having an application for phone and windows 8 app store with the minimum amount of rework is best possible by using MVVM and also a couple of other techniques. There is a detailed <a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/jj681693(v=vs.105">article</a>.aspx) on msdn on how how to maximize code reuse between Windows Phone 8 and Windows 8.</p>

<p>MVVM does really matter now, if we do not want to end up copy pasting code from phone app to the windows 8 store app. Also fixing and adding in new features would become more easier with following MVVM</p>

<p><a href="http://nuget.org/packages/Portable.MvvmLightLibs/">MVVM Toolkit</a> is a very popular helper library for implementing MVVM pattern, as is available on nuget as a PCL(Portable class library)</p>

<p><strong>MVVM<em>, It really does matter !!!</em></strong></p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-03-03T14:23:45+05:30"  data-updated="true" itemprop="datePublished dateCreated">Mar 3<sup>rd</sup>, 2013</time>
        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/windows-phone-series-incremental-loading/" itemprop="url">Windows Phone Series – Incremental Loading</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>Some time back we had a look on doing <a href="http://rahulpnath.wordpress.com/2012/10/28/windows-8-series-incremental-loading/">Incremental Loading with a Windows 8 store app</a>. This same scenario is something that one would come across quite frequently while developing a Windows Phone application too. We have a couple of options in dealing with this while on a Windows phone application. In an ideal case while binding to a large data on a windows phone application, we might be using a <a href="http://msdn.microsoft.com/en-US/library/windowsphone/develop/microsoft.phone.controls.longlistselector(v=vs.105">LongListSelector</a>.aspx) or a Listbox control.</p>

<p>While using a LongListSelector, we can use the Link event(if you are using <a href="http://phone.codeplex.com/">Windows Phone 7.1 toolkit</a>) Or the <a href="http://msdn.microsoft.com/en-US/library/windowsphone/develop/microsoft.phone.controls.longlistselector.itemrealized(v=vs.105">ItemRealized</a>.aspx) event(if you are on Windows phone 8.0). Basically we would be doing the same thing in either of these cases, checking the current item that is getting realized and see what is the index of the item in the whole list of data that you have currently and check if its time for you to fetch the next set of data from your data source(possibly a web service). As usual for the sample we will be using the <a href="http://500px.com/popular">500px</a> api.</p>

<p>Below is the piece of code that will fetch us the photo from the <a href="http://developers.500px.com/">500px api</a> to populate the listbox data.</p>

<p>[csharp]private static int requestPerPage = 20;
private int currentPage = 1;
private bool isCurrentlyLoading = false;</p>

<p>private ObservableCollection<Photo> Photos = new ObservableCollection<Photo>();</p>

<p>private string datasourceUrl=&ldquo;<a href="https://api.500px.com/v1/photos?feature=popular&amp;consumer_key=">https://api.500px.com/v1/photos?feature=popular&amp;consumer_key=</a>&rdquo;
          + consumerKey + &ldquo;&amp;rpp=&rdquo; + requestPerPage.ToString() + &ldquo;&amp;page={0}&rdquo;;</p>

<p>private void LoadDataFromSource()
{
    isCurrentlyLoading = true;
    var query = string.Format(datasourceUrl, currentPage);
    WebClient client = new WebClient();
    client.DownloadStringCompleted += client_DownloadStringCompleted;
    client.DownloadStringAsync(new Uri(query));</p>

<p>}</p>

<p>void client_DownloadStringCompleted(object sender, DownloadStringCompletedEventArgs e)
{
    using (var reader = new MemoryStream(Encoding.Unicode.GetBytes(e.Result)))
    {
        var ser = new DataContractJsonSerializer(typeof(RootObject));
        RootObject obj = (RootObject)ser.ReadObject(reader);
        currentPage = obj.current_page + 1;
        if (obj != null)
        {
            this.Dispatcher.BeginInvoke(() =>
                {
                    foreach (var photo in obj.photos)
                    {
                        Photos.Add(photo);
                    }
                    isCurrentlyLoading = false;
                });
        }
    }
}[/csharp]</p>

<p>In the ItemRealized/Link event based on whether you are developing for Windows Phone 7 or 8, below would be the code that goes into that. We need to check the current item that is realized i.e rendered on the UI and see if it is</p>

<p>[csharp]private void photosList_ItemRealized_1(object sender, ItemRealizationEventArgs e)
{
    Photo photo = e.Container.Content as Photo;
    if (photo != null)
    {
        int offset = 2;
        // Only if there is no data that is currently getting loaded
        // would be initiate the loading again
        if (!isCurrentlyLoading &amp;&amp; Photos.Count - Photos.IndexOf(photo) &lt;= offset)
        {
            LoadDataFromSource();
        }
    }
}[/csharp]</p>

<p>In case you want to use a normal listbox, you can do that also. We would need to hook up with VisualStateGroups. This <a href="http://blogs.msdn.com/b/slmperf/archive/2011/06/30/windows-phone-mango-change-listbox-how-to-detect-compression-end-of-scroll-states.aspx">link</a> explains this in details, and I have just reused parts of it as is. We need to override the scrollviewer style to hook into this new StateGroups. We need to look for CompressionBottom state, for the currentstatechanged event of the scrollviewer.</p>

<p>[csharp]private void myScrollViewer_Loaded_1(object sender, RoutedEventArgs e)
{
    SetScrollViewer();
}</p>

<p>private void SetScrollViewer()
{
    // Visual States are always on the first child of the control template
    FrameworkElement element = VisualTreeHelper.GetChild(myScrollViewer, 0)
                            as FrameworkElement;
    if (element != null)
    {
        VisualStateGroup vgroup = FindVisualState(element, &ldquo;VerticalCompression&rdquo;);</p>

<pre><code>    if (vgroup != null)
    {
        vgroup.CurrentStateChanging += 
             new EventHandler&lt;VisualStateChangedEventArgs&gt;(vgroup_CurrentStateChanging);
    }
}
</code></pre>

<p>}</p>

<p>private void vgroup_CurrentStateChanging(object sender, VisualStateChangedEventArgs e)
{
    if (e.NewState.Name == &ldquo;CompressionTop&rdquo;)
    {</p>

<pre><code>}

if (e.NewState.Name == "CompressionBottom")
{
    if (!isCurrentlyLoading )
    {
        LoadDataFromSource();
    }
}
if (e.NewState.Name == "NoVerticalCompression")
{

}
</code></pre>

<p>}[/csharp]</p>

<p>You can use either of these two ways to incrementally load data on a windows phone app. The entire code that is used in this blog is avaialble <a href="https://github.com/rahulpnath/IncrementalLoadingPhone">here</a>. The sample app shows both these methods. The pivot header specifies the method that is used, LongListSelector and Scrollstates</p>

<p><a href="http://rahulpnath.com/blog/wp-content/uploads/2013/03/wp_ss_20130303_0001.jpg"><img src="http://rahulpnath.com/blog/wp-content/uploads/2013/03/wp_ss_20130303_0001_thumb.jpg" alt="LongListSelector" /></a> <a href="http://rahulpnath.com/blog/wp-content/uploads/2013/03/wp_ss_20130303_0002.jpg"><img src="http://rahulpnath.com/blog/wp-content/uploads/2013/03/wp_ss_20130303_0002_thumb.jpg" alt="ScrollStates" /></a></p>

<p>Hope this helps you to incrementally load data on your windows phone application</p>

<p><a href="https://github.com/rahulpnath/IncrementalLoadingPhone">Download Code</a></p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-01-05T22:07:00+05:30"  data-updated="true" itemprop="datePublished dateCreated">Jan 5<sup>th</sup>, 2013</time>
        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/what-made-me-choose-vanguard-up-rise-45/" itemprop="url">What Made Me Choose : Vanguard UP-Rise 45</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>Deciding on a dslr was not so tough a year back, it was either Canon or Nikon and it just happened that i chose Canon since in the beginner level series neither seemed to make a difference, at least for me. I have a <a href="http://www.amazon.co.uk/Canon-550D-Digital-Camera-Body/dp/B0037KM0EY">Canon 550d</a> with a set of beginner level lenses (a <a href="http://www.amazon.com/Canon-EF-S-18-55mm-3-5-5-6-II/dp/B000V5K3FG/ref=sr_1_1?s=electronics&amp;ie=UTF8&amp;qid=1357390070&amp;sr=1-1&amp;keywords=canon+18-55">18-55mm</a> kit lens, <a href="http://www.amazon.com/Canon-50mm-1-8-Camera-Lens/dp/B00007E7JU/ref=sr_1_1?s=electronics&amp;ie=UTF8&amp;qid=1357390018&amp;sr=1-1&amp;keywords=canon+50mm+1.8">50mm</a> prime and a <a href="http://www.amazon.com/Canon-55-250mm-4-0-5-6-Telephoto-Digital/dp/B0011NVMO8">55-250mm</a> telephoto zoom) and a tripod(1.3 kg ,folded height 460mm).
For over an year I was using the bag that came with my dslr and decided now to upgrade to a better one, as I found it difficult to carry around the camera, lenses and tripod. I was looking for a backpack model and with lots of brands out there choosing one was really a tough thing. At first I did want to have a bag that could take a laptop too, but then decided against it as all those bags that could take a laptop tend to be a bit bulky. Carrying a laptop would be only while I travel and not when I go out for shooting, so then decided against one with a laptop. After some online research I shortlisted a couple of bags.</p>

<ol>
<li><a href="http://products.lowepro.com/product/flipside-300,2083.htm">Lowepro Flipside 300</a></li>
<li><a href="http://products.lowepro.com/product/DSLR-Video%20Fastpack%20250%20AW,2282.htm">Lowepro Video Fastpack 250aw</a></li>
<li><a href="http://products.lowepro.com/product/Pro-Runner-200-AW,2181,14.htm">Lowepro Pro Runner 200AW</a></li>
<li><a href="http://www.manfrotto.com/product/0/MB%2BSB390-3BC/_/Veloce_III_Camera_Backpack_for_DSLR_(Bungee_Cord">Manfrotto Veloce III</a>)</li>
</ol>


<p>Deciding to drop into a store to see them was the best thing that I did, and I suggest everyone planning to buy a dslr bag to do that. What’s good for me, might not work out for you. Except the flipside one I did see everything else. For me the fastpack 250aw was a bit bulky, the Pro Runner a bit too small and lacking a quick access entry. Manfrotto was decent enough but then my tripod would not go through the tripod strap, since my tripod has all its legs connected to the centre rod.
I happened to see the Vanguard Up-rise 43, which was actually a sling bag but had all the other features I was looking for. It was sleek looking, well padded,had a tripod holder(now this one had a adjustable strap to hold the tripod), a quick access,rain cover.
Back home I did again a bit of research and got to see the Up-rise 45,46 and 48, which is the backpack bags in the up-rise series . Now that was what exactly I was looking for. 48 was way too big for me. Now had to choose between the 46 and 45 the only difference being the former could take a laptop too,and was not that bulky too. Also the models are also different. For Up-rise 46 the bag opening was from the <a href="http://www.premier-ink.co.uk/images/images_big/vg_uprise46_1.jpg">front</a> and for Up-rise 45 the opening was from the <a href="http://img2.blogs.yahoo.co.jp/ybi/1/7a/03/shira_gon/folder/1199363/img_1199363_32950708_2?1268142426">back</a>. The Up-rise 46 had just one problem of having the tripod strap on the opening bag flap, having you to untie the tripod first(if you have used that to tie the tripod. This one also does have a elastic band to the middle of the bag through which you can slide your tripod in, as in manfrotto. But then my tripod had to tied using the strap due to the same problem mentioned above).
So finally I had a choice, <a href="http://www.vanguardworld.com/index.php/en/pv/products/detail-1-1-4-33.html">Vanguard Up-Rise 45</a>, at least for now that I feel might be good for me. Just got it shipped today and planning to take it with me for the next trip.
Below are some snaps of the my bag. I did find a good <a href="http://www.youtube.com/watch?v=_A4GN5lJhQY">video</a> on youtube which shows all the features, so I didn’t want to do one again.</p>

<table cellpadding="0" cellspacing="0" style="outline: none; border-style: none; margin: 0; padding: 0; width: 408px; border-collapse: collapse;" border="0" >
<tbody >
<tr >

<td colspan="2" style="outline: none; border-style: none; margin: 0; padding: 5px 0 5px 5px; width: 159px; vertical-align: bottom;" >[ ![View album](http://rahulpnath.com/blog/wp-content/uploads/2013/01/19393306067e1fa083.png)](https://skydrive.live.com/redir.aspx?cid=d5a8034107adc30c&page=play&resid=D5A8034107ADC30C!3950&parid=D5A8034107ADC30C!3949&type=1&Bsrc=Photomail&Bpub=SDX.Photos&authkey=!ABkuQXjWWoHjsww)
</td>

<td colspan="3" style="vertical-align: middle; margin: 0; padding: 5px 5px 5px 0; outline: none; border-style: none; width: 226px;" >





[Vanguard Up-Rise 45](https://skydrive.live.com/redir.aspx?cid=d5a8034107adc30c&page=browse&resid=D5A8034107ADC30C!3949&type=5&authkey=!ABkuQXjWWoHjsww&Bsrc=Photomail&Bpub=SDX.Photos)





<table cellpadding="0" cellspacing="0" style="margin: 0; padding: 0; outline: none; border-style: none; border-collapse: collapse; width: auto;" border="0" >
<tbody >
<tr >

<td style="vertical-align: top; outline: none; border-style: none; margin: 0; padding: 10px 15px 6px 0;" >[VIEW SLIDE SHOW](https://skydrive.live.com/redir.aspx?cid=d5a8034107adc30c&page=play&resid=D5A8034107ADC30C!3949&type=5&authkey=!ABkuQXjWWoHjsww&Bsrc=Photomail&Bpub=SDX.Photos)
</td>

<td style="vertical-align: top; outline: none; border-style: none; margin: 0; padding: 10px 0 6px;" >[DOWNLOAD ALL](https://skydrive.live.com/redir.aspx?cid=d5a8034107adc30c&page=downloadphotos&resid=D5A8034107ADC30C!3949&type=5&Bsrc=Photomail&Bpub=SDX.Photos&authkey=!ABkuQXjWWoHjsww)
</td>
</tr>
</tbody>
</table>





</td>
</tr>
<tr >

<td style="vertical-align: bottom; outline: none; border-style: none; padding: 0 5px 5px; margin: 0; width: 77px; height: 77px;" >[![View album](http://rahulpnath.com/blog/wp-content/uploads/2013/01/1693865447509e80c0.png)](https://skydrive.live.com/redir.aspx?cid=d5a8034107adc30c&page=play&resid=D5A8034107ADC30C!3951&parid=D5A8034107ADC30C!3949&type=1&Bsrc=Photomail&Bpub=SDX.Photos&authkey=!ABkuQXjWWoHjsww)
</td>

<td style="vertical-align: bottom; outline: none; border-style: none; padding: 0 5px 5px 0; margin: 0; width: 77px; height: 77px;" >[![View album](http://rahulpnath.com/blog/wp-content/uploads/2013/01/110869255509e80c0.png)](https://skydrive.live.com/redir.aspx?cid=d5a8034107adc30c&page=play&resid=D5A8034107ADC30C!3952&parid=D5A8034107ADC30C!3949&type=1&Bsrc=Photomail&Bpub=SDX.Photos&authkey=!ABkuQXjWWoHjsww)
</td>

<td style="vertical-align: bottom; outline: none; border-style: none; padding: 0 5px 5px 0; margin: 0; width: 77px; height: 77px;" >[![View album](http://rahulpnath.com/blog/wp-content/uploads/2013/01/752237557e8bd378.png)](https://skydrive.live.com/redir.aspx?cid=d5a8034107adc30c&page=play&resid=D5A8034107ADC30C!3953&parid=D5A8034107ADC30C!3949&type=1&Bsrc=Photomail&Bpub=SDX.Photos&authkey=!ABkuQXjWWoHjsww)
</td>

<td style="vertical-align: bottom; outline: none; border-style: none; padding: 0 5px 5px 0; margin: 0; width: 77px; height: 77px;" >[![View album](http://rahulpnath.com/blog/wp-content/uploads/2013/01/1009512067e8bd378.png)](https://skydrive.live.com/redir.aspx?cid=d5a8034107adc30c&page=play&resid=D5A8034107ADC30C!3954&parid=D5A8034107ADC30C!3949&type=1&Bsrc=Photomail&Bpub=SDX.Photos&authkey=!ABkuQXjWWoHjsww)
</td>

<td style="vertical-align: bottom; outline: none; border-style: none; padding: 0 5px 5px 0; margin: 0; width: 77px; height: 77px;" >[![View album](http://rahulpnath.com/blog/wp-content/uploads/2013/01/93012880699a5105.png)](https://skydrive.live.com/redir.aspx?cid=d5a8034107adc30c&page=play&resid=D5A8034107ADC30C!3955&parid=D5A8034107ADC30C!3949&type=1&Bsrc=Photomail&Bpub=SDX.Photos&authkey=!ABkuQXjWWoHjsww)
</td>
</tr>
</tbody>
</table>


<p>In short the main things that made my choose the Vanguard Up-Rise 45</p>

<ul>
<li><p>Shoulder bag with a sleek design</p></li>
<li><p>Quick access  for the camera</p></li>
<li><p>tripod holder,rain cover</p></li>
<li><p>flipside kind of access too, since the opening was in the back</p></li>
<li><p>good cushion paddings(you don’t feel the weight at all)</p></li>
<li><p>sturdy even with the tripod attached and had no issues accessing the quick access</p></li>
<li><p>all straps could be nicely tucked away into appropriate slots, leaving no hanging straps</p></li>
<li><p>a compartment for accessories</p></li>
</ul>


<p>Hope you have a good time choosing your bag <img src="http://rahulpnath.files.wordpress.com/2013/01/wlemoticon-smile.png" alt="Smile" /></p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-01-04T15:06:48+05:30"  data-updated="true" itemprop="datePublished dateCreated">Jan 4<sup>th</sup>, 2013</time>
        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/windows-8-series-drop-down-button/" itemprop="url">Windows 8 Series – Drop Down Button</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>While working on my Windows 8 Store application, <a href="http://apps.microsoft.com/windows/en-us/app/picfinity/33ba9249-a9f4-44df-973c-21962376c3ea">Picfinity</a> I came across a need for a drop-down button(which I thought was the correct term for this). A similar control is there on the start screen of Windows 8 that gives us options on clicking the logged in user’s image to Change Account picture, Lock, Sign Out etc.</p>

<p><a href="http://rahulpnath.files.wordpress.com/2013/01/image.png"><img src="http://rahulpnath.files.wordpress.com/2013/01/image_thumb.png" alt="image" /></a></p>

<p>I wanted this same behaviour in my application, to provide similar options for the logged in user. The easiest way to achieve this is to use a <a href="http://msdn.microsoft.com/en-us/library/system.windows.controls.primitives.popup.aspx">Popup</a>. The xaml snippet below shows how to get a similar look on your application</p>

<pre><code>&lt;Grid Background="{StaticResource ApplicationPageBackgroundThemeBrush}"&gt;
    &lt;Grid.ColumnDefinitions&gt;
        &lt;ColumnDefinition /&gt;
        &lt;ColumnDefinition Width="Auto" /&gt;
    &lt;/Grid.ColumnDefinitions&gt;
    &lt;TextBlock Text="MY Content" FontSize="30" HorizontalAlignment="Center" 
         VerticalAlignment="Center" /&gt;
   &lt;span style="color:#000000;"&gt; &lt;StackPanel Grid.Column="1" Margin="0,10,30,0" &gt;
        &lt;Button Content="User Name" VerticalAlignment="Top" Click="Button_Click_1" /&gt;
        &lt;Popup IsLightDismissEnabled="True" Name="buttonDropDown"&gt;
            &lt;StackPanel Background="DarkGray"  Width="105"&gt;
              &lt;Button BorderThickness="0" Content="Option1" HorizontalAlignment="Stretch" /&gt;
              &lt;Button BorderThickness="0" Content="Option2" HorizontalAlignment="Stretch" /&gt;
              &lt;Button BorderThickness="0" Content="Option3" HorizontalAlignment="Stretch" /&gt;
            &lt;/StackPanel&gt;
        &lt;/Popup&gt; 
    &lt;/StackPanel&gt;&lt;/span&gt;
&lt;/Grid&gt;
</code></pre>

<p>On click of the button we need to set the popup’s <a href="http://msdn.microsoft.com/en-us/library/system.windows.controls.primitives.popup.isopen.aspx">IsOpen</a> to true. Setting the <a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.controls.primitives.popup.islightdismissenabled">IsLightDismissEnabled</a> to true the popup closes whenever the user taps outside of the popup.
<a href="http://rahulpnath.files.wordpress.com/2013/01/image1.png"><img src="http://rahulpnath.files.wordpress.com/2013/01/image_thumb1.png" alt="image" /></a></p>

<p>Style and color it the way you want it to look and there you have an easy drop-down button for Windows 8.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-10-28T20:11:31+05:30"  data-updated="true" itemprop="datePublished dateCreated">Oct 28<sup>th</sup>, 2012</time>
        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/windows-8-series-incremental-loading/" itemprop="url">Windows 8 Series - Incremental Loading</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>Fast and fluid experience is one of the most important characteristics of a Windows 8 application. As the data becomes larger , it might not be always possible to get the entire data loaded before hand.We might want to have a incremental or sequential data loading so that the user has a better experience.
While developing windows 8 this can be easily achieved by using <a href="http://msdn.microsoft.com/en-us/library/windows/apps/Hh701916">ISupportIncrementalLoading</a>
interface which would load the data incrementally.The class that implements this should also implement the <a href="http://msdn.microsoft.com/en-us/library/system.collections.ilist.aspx">IList</a> and <a href="http://msdn.microsoft.com/en-us/library/system.collections.specialized.inotifycollectionchanged.aspx">INotifyColectionChanged</a>. A sample on how to implement this interface can be seen <a href="http://msdn.microsoft.com/en-us/library/windows/apps/Hh701916">here</a>.
Implementing these over and over for different data sources that you would want to load incrementally might soon become tedious and repetitive.So why not make up some generic classes that you could abstract away the task of loading the data incrementally. That&rsquo;s exactly what we would be looking into here.</p>

<p>First lets get the class that implements <a href="http://msdn.microsoft.com/en-us/library/windows/apps/Hh701916">ISupportIncrementalLoading</a>, IList and INotifyCollectionChanged. To keep things simple lets inherit from ObservableCollection,which in turn inherits the latter 2 interfaces</p>

<pre><code>public class IncrementalSource&lt;T, K&gt; : ObservableCollection&lt;K&gt;, ISupportIncrementalLoading
    where T: class
{
    private string Query { get; set; }
    private int VirtualCount { get; set; }
    private int CurrentPage { get; set; }
    private IPagedSource&lt;T,K&gt; Source { get; set; }
    private int rpp { get; set; }

    public IncrementalSource(string query, Func&lt;T, IPagedResponse&lt;K&gt;&gt; GetPagedResponse)
    {
        this.Source = new PagedSourceLoader&lt;T, K&gt;(GetPagedResponse);
        this.VirtualCount = int.MaxValue;
        this.CurrentPage = 0;
        this.Query = query;
    }

    #region ISupportIncrementalLoading

    public bool HasMoreItems
    {
        get { return this.VirtualCount &gt; this.CurrentPage * (rpp == 0 ? 10 :rpp); }
    }

    public IAsyncOperation&lt;LoadMoreItemsResult&gt; LoadMoreItemsAsync(uint count)
    {
        CoreDispatcher dispatcher = Window.Current != null ? Window.Current.Dispatcher : Windows.ApplicationModel.Core.CoreApplication.MainView.CoreWindow.Dispatcher;
        if (count &gt; 50 || count &lt;= 0)
        {
            // default load count to be set to 50
            count = 50;
        }

        return Task.Run&lt;LoadMoreItemsResult&gt;(
            async () =&gt;
            {

                IPagedResponse&lt;K&gt; result = await this.Source.GetPage(string.Format(this.Query,count), ++this.CurrentPage, (int)count);

                this.VirtualCount = result.VirtualCount;
                if (rpp == 0)
                {
                    rpp = result.rpp;
                }

                await dispatcher.RunAsync(
                    CoreDispatcherPriority.Normal,
                    () =&gt;
                    {
                        foreach (K item in result.Items)
                            this.Add(item);
                    });

                return new LoadMoreItemsResult() { Count = (uint)result.Items.Count() };

            }).AsAsyncOperation&lt;LoadMoreItemsResult&gt;();
    }

    #endregion
}
</code></pre>

<p>Before going into the details of the code, lets understand what this class is going to do for us. We need to load data in a paged fashion from a large datasource. So we would generally be dealing with two types of object – one the type of object(<strong><em>K</em></strong>) whose list we are trying to load incrementally. Another one the type of object(<strong><em>T</em></strong>) that represents each paged request result. This object would ideally contain a property to hold list of objects of type K, the total number of items that the datasource would give us,so that we know how many pages we need to request for and also a property indicating the current page. Each datasource might return us these required properties in different property names and types. So we have a class to hold these data together for us, PagedResponse which implements IPagedResponse</p>

<pre><code>public interface IPagedResponse&lt;T&gt;
{
    IEnumerable&lt;T&gt; Items { get; }
    int VirtualCount { get; }
    int rpp { get; set; } // rpp - requests per page
}




public class PagedResponse&lt;K&gt; : IPagedResponse&lt;K&gt;
{
    public PagedResponse(IEnumerable&lt;K&gt; items, int virtualCount,int itemsPerPage)
    {
        this.Items = items;
        this.VirtualCount = virtualCount;
        rpp = itemsPerPage;
    }

    public int VirtualCount { get; private set; }
    public int rpp { get;  set; }
    public IEnumerable&lt;K&gt; Items { get; private set; }
}
</code></pre>

<p>That said lets see the  <em>IncremetnalSource</em> class. It takes in the object type <strong><em>T </em></strong>and <strong><em>K.</em></strong>The constructor takes in the url where the datasource can be found.The Func&lt;T, IPagedResponse<K>> parameter represents a function that takes in the return type of the call to the url as a parameter and returns the PagedResponse type. In other words that function converts the paged request call type to the type that we use to represent it, IPagedResponse.See a sample below.</p>

<p>[sourcecode language=&ldquo;csharp&rdquo;]
private PagedResponse<Photo> RootObjectResponse(RootObject rootObject)
{
    return new PagedResponse<Photo>(rootObject.photos, rootObject.total_items, rootObject.photos != null ? rootObject.photos.Count : 0);
}
[/sourcecode]</p>

<p>Now we need to make the call to the datasource url. This might return us data in different formats, most popularly json or xml. So we would always want to abstract away the loading of data to another class so that we don’t get tied up with the data formats in <em>IncrementalSource.</em></p>

<p>IPagedSource&lt;T,K> will do this for us. A sample implementation of this is <em>PagedSourceLoader </em>that handles for json return type is below</p>

<pre><code>public interface IPagedSource&lt;R,K&gt;
{
    Task&lt;IPagedResponse&lt;K&gt;&gt; GetPage(string query, int pageIndex, int pageSize);
}




public class PagedSourceLoader&lt;T,K&gt; : IPagedSource&lt;T,K&gt;
    where T:class 
{
    private Func&lt;T, IPagedResponse&lt;K&gt;&gt; getPagedResponse;
    public PagedSourceLoader(Func&lt;T, IPagedResponse&lt;K&gt;&gt; GetPagedResponse)
    {
        getPagedResponse = GetPagedResponse;
    }

    #region IPagedSource

    public async Task&lt;IPagedResponse&lt;K&gt;&gt; GetPage(string query, int pageIndex, int pageSize)
    {
        query += "&amp;page="+pageIndex;
        HttpClient client = new HttpClient();
        HttpResponseMessage response = await client.GetAsync(query);
        var data = await response.Content.ReadAsStreamAsync();
        DataContractJsonSerializer json = new DataContractJsonSerializer(typeof(T));
        T dat = json.ReadObject(data) as T;
        return getPagedResponse(dat);
    }

    #endregion
}
</code></pre>

<p>As you see above the <em>PagedSourceLoader</em> gets the json from the datasource url and converts to the type that we are interested in . You could always replace this class to use any other data format as you would want. Mostly you would just want one implementation for <em>IPagedSource&lt;T,K>, </em>as your data source would always return you the same data format. In case not you could inject that too into the <em>IncrementalSource</em> class.</p>

<p>I have a sample <a href="http://sdrv.ms/RdPtdL">here</a> that incrementally loads the photos from a photo site <a href="http://500px.com/flow">500px</a>. You would need to register for an to get the consumer key,which should hardly take some time <a href="http://500px.com/settings/applications?from=developers">here</a>.</p>

<p><a href="http://rahulpnath.files.wordpress.com/2012/10/incrementalloading.png"><img src="http://rahulpnath.files.wordpress.com/2012/10/incrementalloading.png?w=300" alt="" /></a></p>

<p><a href="http://sdrv.ms/RdPtdL">Download the sample source code</a></p>

<p>Keep a sample of the source code for yourself in case you wanted this specific version. I might refine this to a more usable library with couple of default <em>PagedSourceLoader.</em></p>

<p><strong>References:
</strong><a href="http://www.silverlightplayground.org/post/2012/06/10/Metro-Incrementally-load-GridView-and-ListView-with-ISupportIncrementalLoading.aspx">Metro: Incrementally load GridView and ListView with ISupportIncrementalLoading</a></p>

<p>Feel free to reuse it if you find it useful and drop a comment to refine it.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-10-05T17:30:27+05:30"  data-updated="true" itemprop="datePublished dateCreated">Oct 5<sup>th</sup>, 2012</time>
        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/exploring-oauth-c-and-500px/" itemprop="url">Windows 8 Series - Exploring OAuth: C# and 500px</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>The days when we ourselves developed sites and application for our own services are long gone. Now it’s about building api’s, sharing data and going social that&rsquo;s the buzz. No more is it a feasible solution to build applications for the numerous devices, that varies in size,shape and by the software that runs in them. The best thing then would be to expose API’s so that anybody interested can build applications for you. In any case the last thing that you would want to share is your users credentials. This is where OAuth comes into picture. Put it simply OAuth is an open protocol that allows secure access to the data that you want to expose, usually the API.</p>

<p>Most of us would have seen OAuth in action. Whenever you logon to a site using any of the social network sites identity,be it Facebook or Twitter it’s OAuth that is behind the scenes that helps the site to get the required information from the social entity and you don’t have to disclose your social credentials to the site that you actually intended to visit. If you have never seen this now is a good time to. Try it <a href="http://500px.com/">here</a></p>

<p>Now that you have seen how it works lets dig deeper to see how to get this feature into the apps that you are building. There are a lot of c# libraries,so are for other languages, that will handle the OAuth part for you like some listed <a href="http://nuget.org/packages?q=oauth&amp;prerelease=&amp;sortOrder=package-download-count">here</a>, keeping the mystery unsolved.</p>

<p>I chose the web-api provided by <a href="http://developers.500px.com/">500px</a>, which does secure its data using OAuth. You can see the complete documentation of the api <a href="https://github.com/500px/api-documentation">here</a>. It is the Authentication part in that, that we would be concentrating here on, using OAuth 1.0</p>

<p><a href="http://rahulpnath.files.wordpress.com/2012/10/image.png"><img src="http://rahulpnath.files.wordpress.com/2012/10/image_thumb.png" alt="image" /></a></p>

<p>On a high level as seen above,OAuth has 3 steps.    <br/>
1. Getting a request token     <br/>
2. Authorizing the user     <br/>
3. Getting the access token.</p>

<p>The access token is then used to access any protected resource.</p>

<p>The following definitions, as from the <a href="http://oauth.net/core/1.0/">OAuth specification</a> is worth knowing before we delve in</p>

<p>Service Provider:    <br/>
A web application that allows access via OAuth.     <br/>
User:     <br/>
An individual who has an account with the Service Provider.     <br/>
Consumer:     <br/>
A website or application that uses OAuth to access the Service Provider on behalf of the User.     <br/>
Protected Resource(s):     <br/>
Data controlled by the Service Provider, which the Consumer can access through authentication.     <br/>
Consumer Developer:     <br/>
An individual or organization that implements a Consumer.     <br/>
Consumer Key:     <br/>
A value used by the Consumer to identify itself to the Service Provider.     <br/>
Consumer Secret:     <br/>
A secret used by the Consumer to establish ownership of the Consumer Key.     <br/>
Request Token:     <br/>
A value used by the Consumer to obtain authorization from the User, and exchanged for an Access Token.     <br/>
Access Token:     <br/>
A value used by the Consumer to gain access to the Protected Resources on behalf of the User, instead of using the User’s Service Provider credentials.     <br/>
Token Secret:     <br/>
A secret used by the Consumer to establish ownership of a given Token.     <br/>
OAuth Protocol Parameters:     <br/>
Parameters with names beginning with oauth_.</p>

<p>Before getting on to the steps we would need to register the application that is going to consume the web api, to get the Consumer Key and Consumer Secret required in OAuth.You can do that here for <a href="http://500px.com/settings/applications">500px</a>. All web-api’s supporting OAuth would have such a page, as registering provides us with the keys. If the application does not have a callback url, like in case you are developing for a phone or desktop application you can specify any url you want.</p>

<p><a href="http://rahulpnath.files.wordpress.com/2012/10/image1.png"><img src="http://rahulpnath.files.wordpress.com/2012/10/image_thumb1.png" alt="image" /></a></p>

<p>The base URL for 500px web-api is ‘<a href="https://api.500px.com/v1/">https://api.500px.com/v1/</a>’. All further references to url’s would be relative to this</p>

<p><strong>Getting the Request Token</strong></p>

<hr />

<p><strong> </strong>To get the request token we need to make a POST request to <a href="https://github.com/500px/api-documentation/blob/master/authentication/POST_oauth_requesttoken.md"><em>oauth/request_token</em></a>, which expects the parameters <em>CallbackUrl,ConsumerKey,Nonce,SignatureMethod,Timestamp and OAuthVersion. </em>All these should be in the same order,i.e alphabetical. All these parameters needs to be signed using the consumer secret and the signature too needs to be attached in the request data. This data goes as part of the ‘<em>Authorization’</em> header of the request.</p>

<pre><code>public async Task&lt;OauthToken&gt; RequestToken() 
       { 
           AuthorizationParameters = new Dictionary&lt;string, string&gt;(){                                
                             {OauthParameter.OauthCallback, OAuthCallbackUrl}, 
                             {OauthParameter.OauthConsumerKey, consumerKey}, 
                             {OauthParameter.OauthNonce, Nonce()}, 
                             {OauthParameter.OauthSignatureMethod,OAuthSignatureMethod}, 
                             {OauthParameter.OauthTimestamp, TimeStamp()}, 
                             {OauthParameter.OauthVersion, OAuthVersion} 
                               }; 
           string response = await this.MakeRequest(RequestType.POST) 
               .Sign(OAuthRequestUrl, String.Empty) 
               .ExecuteRequest(OAuthRequestUrl); 

……… 
</code></pre>

<p>The above function handles adding the parameters required and executing the request.</p>

<p>The <em>MakeRequest</em> call specifies the kind of HTTP call that you want to make, here it being a POST. The call to the function <em>Sign, </em>signs the parameters and adds the signature details to the parameter list. It uses the same signature method as specified in the parameter list, <em>HMAC-SHA1</em></p>

<pre><code>private Oauth500px Sign(string Url, string tokenSecret) 
       { 
           String SigBaseStringParams = String.Join("&amp;", AuthorizationParameters.Select(key =&gt; key.Key + "=" + Uri.EscapeDataString(key.Value))); 
           String SigBaseString = requestType.ToString() + "&amp;"; 
           SigBaseString += Uri.EscapeDataString(Url) + "&amp;" + Uri.EscapeDataString(SigBaseStringParams);

           IBuffer KeyMaterial = CryptographicBuffer.ConvertStringToBinary(consumerSecret + "&amp;" + tokenSecret, BinaryStringEncoding.Utf8); 
           MacAlgorithmProvider HmacSha1Provider = MacAlgorithmProvider.OpenAlgorithm(OAuthSignatureMethodName); 
           CryptographicKey MacKey = HmacSha1Provider.CreateKey(KeyMaterial); 
           IBuffer DataToBeSigned = CryptographicBuffer.ConvertStringToBinary(SigBaseString, BinaryStringEncoding.Utf8); 
           IBuffer SignatureBuffer = CryptographicEngine.Sign(MacKey, DataToBeSigned); 
           String Signature = CryptographicBuffer.EncodeToBase64String(SignatureBuffer); 
           AuthorizationParameters.Add(OauthParameter.OauthSignature, Signature); 
           return this; 
       } 
</code></pre>

<p>The <em>ExecueRequest</em> handles adding the details to the authorization header and making the request and returning the response.</p>

<p>A successful call to request token will return <em>Request Token</em> and a <em>token secret </em>which is to be used in the subsequent call to Authorize</p>

<p><strong>Authorize</strong></p>

<p>The call to authorize brings up the login page of the Service Provider(500px),if the user is not already logged in and is used to authorize the request token that has been just obtained. The request to authorize is to be made at <a href="https://github.com/500px/api-documentation/blob/master/authentication/POST_oauth_authorize.md">oauth/authorize</a>, with the request token received in the previous call.</p>

<pre><code>public async Task&lt;OauthToken&gt; AuthorizeToken() 
       { 
           var tempAuthorizeUrl = OAuthAuthorizeUrl + "?oauth_token=" + Token.Token;
           System.Uri StartUri = new Uri(tempAuthorizeUrl); 
           System.Uri EndUri = new Uri(OAuthCallbackUrl);
           var auth = 
               await 
               WebAuthenticationBroker.AuthenticateAsync(WebAuthenticationOptions.None, StartUri, EndUri);
           var responseData = auth.ResponseData;
</code></pre>

<p>Since this is for Windows8 I use the WebAuthenticationBroker to issue the request to authorize the user, which will open up a nice UI asking the user credentials. On entering the login details and getting successfully authorized, we would get the <em>request token</em> and the <em>oauth_verifier</em> code.</p>

<p><strong>Access Token</strong></p>

<p>This final step gives you the access token, that is used for any request to a protected resource. A POST request it to made to the url <a href="https://github.com/500px/api-documentation/blob/master/authentication/POST_oauth_accesstoken.md">oauth/access_token</a>, with the parameters <em>ConsumerKey, Nonce, SignatureMethod, Timestamp, RequestToken, VerifierCode and OAuthVersion, </em>again all alphabetical sorted and signed using the consumer key and token secret that we got in the call to request token.</p>

<pre><code>public async Task&lt;OauthToken&gt; AccessToken() 
       { 
           AuthorizationParameters = new Dictionary&lt;string, string&gt;() 
                   { 
                       {OauthParameter.OauthConsumerKey, consumerKey}, 
                       {OauthParameter.OauthNonce, Nonce()}, 
                       {OauthParameter.OauthSignatureMethod,OAuthSignatureMethod}, 
                       {OauthParameter.OauthTimestamp, TimeStamp()}, 
                       {OauthParameter.OauthToken,Token.Token}, 
                       {OauthParameter.OauthVerifier,Token.Verifier}, 
                       {OauthParameter.OauthVersion, OAuthVersion} 
                   }; 
           var response = await this.MakeRequest(RequestType.POST) 
               .Sign(OAuthAccessUrl, Token.SecretCode) 
               .ExecuteRequest(OAuthAccessUrl);

……. 
</code></pre>

<p>The SecretCode, that was obtained from the call to Requesttoken is also passed to the function _Sign.</p>

<p>_A successful call would return you the AccessToken and the Access token’s secret code for that. All subsequent request to any protected resource needs the AccessToken and should be signed using ConsumerKey and the access token’s secret code.</p>

<p>From now on any request to a protected resource should be made with the following parameters: <em>ConsumerKey,Nonce,SignatureMethod,Timestamp,OAuthToken and OAuthVersion</em> along with any additional parameters<em>. </em>This should be signed using the consumer secret and the access token secret code.</p>

<p>The ExecuteRequest handles for this and is a genenric function that would allow you to specify the return type that you are expecting and the Url of the protected resource</p>

<pre><code>public async Task&lt;T&gt; ExecuteRequest&lt;T&gt;(string Url, Dictionary&lt;string, string&gt; Parameters) where T : class 
     { 
         AuthorizationParameters = new Dictionary&lt;string, string&gt;() 
                                       { 
                                           {OauthParameter.OauthConsumerKey, consumerKey}, 
                                           {OauthParameter.OauthNonce, Nonce()}, 
                                           {OauthParameter.OauthSignatureMethod, OAuthSignatureMethod}, 
                                           {OauthParameter.OauthTimestamp, TimeStamp()}, 
                                           {OauthParameter.OauthToken, Token.Token}, 
                                           {OauthParameter.OauthVersion, OAuthVersion} 
                                       };

         string RequestUrl; 
         if (Parameters != null &amp;&amp; Parameters.Count &gt; 0) 
         { 
             RequestUrl = Url + "?" + 
                          String.Join("&amp;", 
                          Parameters.Select(a =&gt; a.Key + (string.IsNullOrEmpty(a.Value) ? string.Empty : "=" + Uri.EscapeDataString(a.Value))).ToArray()); 
             foreach (var parameter in Parameters) 
             { 
                 AuthorizationParameters.Add(parameter.Key, parameter.Value); 
             } 
         } 
         else 
             RequestUrl = Url; 
         var response = await this.MakeRequest(requestType).Sign(Url, Token.SecretCode).ExecuteRequest(RequestUrl); 
         if (string.IsNullOrEmpty(response)) 
             return null; 
         DataContractJsonSerializer json = new DataContractJsonSerializer(typeof(T)); 
         T dat = json.ReadObject(new MemoryStream(Encoding.UTF8.GetBytes(response))) as T; 
         return dat; 
     }
</code></pre>

<p>A sample way to use this would be as below</p>

<p>[sourcecode language=&ldquo;csharp&rdquo;]Oauth500Px.MakeRequest(Oauth500px.RequestType.GET).ExecuteRequest&lt;PhotoDetails&gt;(
                    photoDetails, null);
[/sourcecode]</p>

<p>The code for the OAuth wrapper for 500px specific toWindows8 is available <a href="http://sdrv.ms/PWyHQR">here</a> for download. Feel free to modify it and use it.</p>

<p>I will be refactoring the code out a bit more and also add a few functionalities. So in case you wanted this specific version do keep a copy for yourself.</p>

<p>PS: Incorporating an offline comment that I had got, on putting a space after each full stop and hope I have not missed any.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-08-22T12:08:11+05:30"  data-updated="true" itemprop="datePublished dateCreated">Aug 22<sup>nd</sup>, 2012</time>
        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/getting-started-with-asp-net-web-api/" itemprop="url">Getting Started With ASP.NET Web Api</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>A web api is to expose your application’s programming interface over the web,using the HTTP interface.This makes the api accessible from any device that can make HTTP calls.With the wide range of devices that’s available nowadays,Web Api would be the best way to reach out to all of them.Web Api helps you to open up your application to other developers and encourage them to build device specific application.</p>

<p>Since Web Api uses HTTP,this can be accessed from any device that supports HTTP.A brief glance through the <a href="http://www.w3.org/Protocols/HTTP/1.1/rfc2616.pdf">HTTP spec</a> would be good for a better understanding on the capabilities of HTTP.The web was mostly used for human-to-machine conversations and we never felt the need of these API’s.But increasingly with different devices and applications talking with each other,machine-to-machine conversations is on the rise,making the <a href="http://www.programmableweb.com/">web programmable</a>.</p>

<p>We will be building a web api for a Cafeteria(over many blog posts) that is looking out to have a web presence,so that they can reach out easily to their customers on various devices.The cafeteria has lots of food items and beverages and they are looking for a solution where there customers can see all these items from their mobile/laptops and order these items and collect them from the counter.In this blog post we would be concentrating only on viewing/managing the food dishes/beverages and we would be building on the solution in later posts
Let’s get started building our Web API.!!</p>

<p>Fire up your Visual Studio.Get the <a href="http://www.asp.net/mvc/mvc4">ASP.NET MVC4</a> installed before that.I am having <a href="http://www.microsoft.com/visualstudio/11/en-us">VS2012</a> which has it by default.</p>

<p>Create a New Project: File –> New Project –> ASP.NET MVC4 Web Application.Enter your path and solution name and pressing Ok will give you another screen where you can select what kind of template you want to use.For this we would be using Web Api template.</p>

<p><a href="http://rahulpnath.files.wordpress.com/2012/08/image.png"><img src="http://rahulpnath.files.wordpress.com/2012/08/image_thumb.png" alt="image" /></a></p>

<p>On pressing Ok Visual Studio will create you a set of default controllers and views to start with.Build and run to verify that we have all set up correctly.You should be seeing a nice welcome screen if everything is fine.</p>

<p><a href="http://rahulpnath.files.wordpress.com/2012/08/image1.png"><img src="http://rahulpnath.files.wordpress.com/2012/08/image_thumb1.png" alt="image" /></a></p>

<p>If you see in the solution explorer in Visual Studio,you notice that you already have 2 Controllers that are  created by the default template.A ‘<em>HomeController’</em> that derives from <em>Controller</em> which is your default MVC controller that just rendered out the beautiful page that you just saw above and a ‘<em>ValuesController’</em> that derives from <em>ApiController </em>which is actually our web api controller.</p>

<p>Web Api also uses routes to map URI’s to controller actions.But the difference with MVC route is that,here we have no actions specified in the route value.The HTTP method becomes the action.So your controller would have functions with the same names as the HTTP verbs(GET,PUT,POST,DELETE).If you don’t like these function names then there are attributes too that you can use to mark your own function names.We will see all this in our code.</p>

<p>The default route that is created for Web Api can be found in the <em>App_Start/WebApiConfig  _
[code]config.Routes.MapHttpRoute(
name: &ldquo;DefaultApi&rdquo;,
routeTemplate: &ldquo;api/{controller}/{id}&rdquo;,
defaults: new { id = RouteParameter.Optional }
);[/code]
Now that you have seen the API route,lets try invoking the </em>ValuesController <em>that got created automatically.Following the route that is specified above we need to prefix the controller with an </em>api/.<em>This is just to keep a distinction between the normal MVC controllers and the API controllers.So for the </em>ValuesController<em> we would need to invoke it with ‘</em>api/values<em>’.
To issue a GET on the controller,issue the request using the web browser as shown below.It should return you the values(‘value1’ &amp; ‘value2’ as returned in the GET of the </em>ValuesController_) in json format,as that is the default formatter that is used.</p>

<p><a href="http://rahulpnath.files.wordpress.com/2012/08/image2.png"><img src="http://rahulpnath.files.wordpress.com/2012/08/image_thumb2.png" alt="image" /></a></p>

<p>To check the remaining of HTTP actions we would need to write the implementations for those functions as the <em>ValuesController </em>does not have that implemented.</p>

<p>So lets get back to the Cafeteria business.We will create a model to represent the FoodDishes that the cafeteria has to offer.For now we will just have a id,name and description field in the model.
[csharp]public class FoodDish
{
public int FoodDishId { get; set; }</p>

<p>[Required]
public string FoodDishName { get; set; }</p>

<p>public string Description { get; set; }
}[/csharp]
Note the ‘<em>[Required]</em>’ attribute on the property FoodDishName.This ensures that a value is always present for that property.This is similar to the validation in MVC.A list of supported attributes can be found <a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.aspx">here</a>
Visual Studio will do most of  the job in creating out the controllers and the data context’s for us,with just a couple of clicks.To group the WEB API controllers together lets create a folder under the Controllers folder named ‘<em>api</em>’. This is just for a convention and is not mandatory.Right Click on the newly created ‘<em>api’ </em>folder and say Add –> Controller</p>

<p>Give the controller name as ‘FoodDishesController’.From the template drop down select the ‘API Controller with read/write actions,using Entity Framework’ option.This is what is automatically going to put out the all the code that we would required.Select the ModelClass that we created,<em>FoodDish.</em>(If you don&rsquo;t see the class in the models, build the solution before adding new controller).For the DataContext select ‘<em><New Data Context…></em>’ and enter <em>FoodDishesContext.</em>Refer the image below.</p>

<p><a href="http://rahulpnath.files.wordpress.com/2012/08/image3.png"><img src="http://rahulpnath.files.wordpress.com/2012/08/image_thumb3.png" alt="image" /></a></p>

<p>On clicking Add,the controller gets created successfully and also the database connections are setup automatically using <a href="http://weblogs.asp.net/scottgu/archive/2010/07/16/code-first-development-with-entity-framework-4.aspx">EF Code First approach</a>.Let’s take a deeper look into the Controller that has got created.
You notice that all the methods in the controller has one of the HTTP verb prefixed.ASP.NET WEB API is intelligent enough to understand this naming convention too.So if you don’t like just the http verbs as function name you can use this approach too.Below image shows the possible combinations of function naming.You can use anyone that suites you.</p>

<p><a href="http://rahulpnath.files.wordpress.com/2012/08/image4.png"><img src="http://rahulpnath.files.wordpress.com/2012/08/image_thumb4.png" alt="image" /></a></p>

<p>The WEB API is all set to be tested.To issues a GET,same as we did before,from the browser hit the ‘<em>/api/FoodDishes</em>’.The first request might take up some time to return as Entity Framework needs to set up the database.But in sometime you should get back the json result.But this time it would be a blank one as are yet to add any food dishes to the database.For that we need to do a POST to the <em>FoodDishes </em>controller.For this we will be using <a href="http://www.fiddler2.com/fiddler2/"><em>Fiddler</em></a><em>,</em>which is an excellent tool for web debugging.You should be getting to download it for free from <a href="http://www.fiddler2.com/fiddler2/version.asp">here</a>.
In Fiddler select the Composer tab and enter in the details that is required.Make the HTTP action as POST,enter the ValuesController URI,specify the <em>Content-Type</em> as ‘<em>application/json</em>’<em>  </em>and also provide the sample data as shown in the image below.</p>

<p><a href="http://rahulpnath.files.wordpress.com/2012/08/image5.png"><img src="http://rahulpnath.files.wordpress.com/2012/08/image_thumb5.png" alt="image" /></a></p>

<p>On clicking execute you should be seeing an entry in fiddler with HTTP status code 201,indicating that the entry has been successfully created.In the response you can see the location of this newly created food dish and how to reach that.For me it is at ‘_<a href="http://localhost:61150/api/FoodDishes/1_">http://localhost:61150/api/FoodDishes/1_</a>&lsquo;.So we have successfully created a new fooddish.</p>

<p><a href="http://rahulpnath.files.wordpress.com/2012/08/image6.png"><img src="http://rahulpnath.files.wordpress.com/2012/08/image_thumb6.png" alt="image" /></a></p>

<p>Now to see the newly created dish you can either use a GET on ‘/api/FoodDishes’ to get all the food dishes or GET on /api/FoodDishes/1’ to get the specific Food dish.
Now this can be accessed from any device that supports issuing HTTP calls and you have your first WEB API ready,which just does a <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> over your FoodDishes.</p>

<p>Lets take a deeper look in the controller,to see how all this is happening.Will look into the GET and POST here in this post as DELETE and PUT would be then easy to follow.
The GET method that visual studio scaffolded for us,just returns the requested fooddish from the database.If the food item does not exists it returns a ‘NotFound’/404 error.Notice that here we are using HTTP’s error code’s so that client can easily understand the error.
[csharp]public FoodDish GetFoodDish(int id)
{
FoodDish fooddish = db.FoodDishes.Find(id);
if (fooddish == null)
{
throw new HttpResponseException(Request.CreateResponse(HttpStatusCode.NotFound));
}</p>

<p>return fooddish;
}[/csharp]
The POST method,checks if the new fooddish entered is valid.In our case we have FoodDishName as a required attribute,so as long as that property is present the ModelState.IsValid would be true.If you have additional validation attributes those would be checked too.If the state is valid then the item is inserted into the database and in the response we write the Location where this new fooddish can be accessed from.This location is what we saw above in the fiddler response.If the ModelState is not valid we sent a BadRequest,so that client can recheck the data send.We can send customized error messages too back to the client,so that the client understands where exactly the issue is.I will be covering validation,authentication and error reporting in a separate post,as that calls for a deeper explanation
[csharp][HttpPost]
public HttpResponseMessage CreateNewFoodDish(FoodDish fooddish)
{
if (ModelState.IsValid)
{
db.FoodDishes.Add(fooddish);
db.SaveChanges();</p>

<p>HttpResponseMessage response = Request.CreateResponse(HttpStatusCode.Created, fooddish);
response.Headers.Location = new Uri(Url.Link(&ldquo;DefaultApi&rdquo;, new { id = fooddish.FoodDishId }));
return response;
}
else
{
return Request.CreateResponse(HttpStatusCode.BadRequest);
}
}[/csharp]
DELETE and PUT is very similar and should be easy to understand.</p>

<p>So we have our first WEB API exposed and accessible to everyone from a wide range of devices or different technology.This can be consumed for a website or a mobile or slate etc.To put it simple from any device that supports HTTP.
This should help you get started on with ASP.NET web api.There are a lot more features in ASP.Net Web api like Formatters,Odata support,hosting etc. I would be covering these too in other blog posts.There are a lot of design considerations that need to be taken on while developing API’s.There are a lot of good resource that can help you with tackling down it.I have mentioned a few below in the resources section.</p>

<p>Happy Coding <img src="http://rahulpnath.files.wordpress.com/2012/08/wlemoticon-smile.png" alt="Smile" /></p>

<p><strong>Resources:
</strong>None of them are specific to ASP.NET Web Api,but they should help you to get the bigger picture and also help you in designing good Web API.</p>

<ol>
<li><p><a href="http://www.w3.org/Protocols/HTTP/1.1/rfc2616.pdf">HTTP Spec</a></p></li>
<li><p><a href="http://shop.oreilly.com/product/0636920021575.do">REST Api Design Rulebook</a></p></li>
<li><p><a href="http://shop.oreilly.com/product/9780596805838.do">REST in Practice Hypermedia and Systems Architecture</a></p></li>
<li><p><a href="http://shop.oreilly.com/product/9780596529260.do">RESTful Web Services</a></p></li>
<li><p><a href="http://shop.oreilly.com/product/0636920020530.do">Building Hypermedia APIs with HTML5 and Node</a></p></li>
<li><p><a href="http://info.apigee.com/Portals/62317/docs/web%20api.pdf">Web API Design</a></p></li>
</ol>

</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-07-07T15:46:57+05:30"  data-updated="true" itemprop="datePublished dateCreated">Jul 7<sup>th</sup>, 2012</time>
        
      </p>
    
    
      <h1 class="entry-title" itemprop="name headline"><a href="/blog/wcf-to-asp-net-web-api/" itemprop="url">WCF to ASP.NET Web API</a></h1>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>Windows Communication Foundation(WCF) brought around a unified programming model for building service oriented application.All the previous technologies that was used to build services like MSMQ, remoting, ASMX Web Services,all came under one umbrella.</p>

<p>WCF had embraced SOAP,moving away from the <a href="http://rahulpnath.wordpress.com/2011/06/11/rest-after-a-long-time/">restful web</a> giving all sorts of flexibility and configurability.Everyone was happy for sometime thinking about the power that actually WCF gave by just changing a set of configurations and embraced it entirely.But then most of this configuration did not apply to many of the user scenario,and just went unused,coming with the extra ‘baggage’ that SOAP had to carry around.</p>

<p>I found Scott’s summary the best,as in this <a href="http://www.hanselminutes.com/264/this-is-not-your-fathers-wcf-all-about-the-webapi-with-glenn-block">podcast</a>,when he speaks of WCF     <br/>
”<em>If you are giving me an api whose strong point is it can talk over multi transport and <br/>
has abstracted me away from the details that i actually need in the name of flexibility that i am not going to use,then that is just baggage</em>”</p>

<p>WCF had its own way of being restful,so came WCF WebHTTP,WCF Rest Starter Kit and even a WCF Web Api.Apparently ASP.NET MVC,which is inherently restful,was also having getting capabilities to build basic web Api’s.</p>

<p>With <a href="http://www.asp.net/mvc/mvc4">ASP.NET MVC 4</a> , both the paths that REST had taken merges as <a href="http://www.asp.net/web-api">ASP.NET Web API</a>.     <br/>
So yes this is the ideal platform for building Restful services on the .NET Framework.    <br/>
Web API is nothing but services exposed over http,providing reach to various devices and platforms without doubt,as http is supported across platforms and devices.SOAP did use http,but it used it more as a transport than an application protocol,by sending message packets over http.But with Web Api the ‘contract’ is the actions of HTTP –GET ,PUT ,POST ,DELETE etc..</p>

<p>All said WCF still holds good in cases where SOAP is necessary,where it was actually intended to be used.It’s just the REST’ful part take a new form.</p>

<p>Can’t wait to get you hands dirty!!!! Jump in with <a href="http://channel9.msdn.com/Events/TechEd/NorthAmerica/2012/DEV309">this</a>.</p>
</div>
  
  


        </article>
      
    </div>

    <ul class="pager">
      
        <li class="previous"><a href="/posts/4">&larr;&nbsp;Older</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
        <li class="next"><a href="/posts/2">Newer&nbsp;&rarr;</a></li>
      
    </ul>
  </div>

  
    <aside class="sidebar col-md-3">
      
        <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/knockoutjs-for-xaml-developers/">KnockoutJS for XAML Developers</a>
    
    <a class="list-group-item " href="/blog/thanks-to-everyone-who-attended-our-talk-at-microsoft-india-hyderabad/">Thanks to Everyone Who Attended Our Talk at Microsoft India, Hyderabad</a>
    
    <a class="list-group-item " href="/blog/azure-web-sites-moving-wordpress-to-cloud/">Azure Web Sites: Moving Wordpress to Cloud</a>
    
    <a class="list-group-item " href="/blog/windows-phone-series-image-caching-library-jetimageloader/">Windows Phone Series: Image Caching Library - JetImageLoader</a>
    
    <a class="list-group-item " href="/blog/review-two-months-and-counting-android-and-nexus-5/">Review: Two Months and Counting - Android and Nexus 5</a>
    
  </div>
</section>






      
    </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2014 - Rahul Nath<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>


  </body>
</html>
